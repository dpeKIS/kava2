<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scan | JavaJolt Junkies</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-amber-50 to-amber-100 flex items-center justify-center p-4">
  <div class="w-full max-w-md">
    <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
      <div class="bg-amber-600 p-6 text-center">
        <i data-feather="coffee" class="text-white w-12 h-12 mx-auto mb-4"></i>
        <h1 class="text-2xl font-bold text-white">Log Your Coffee</h1>
      </div>

      <div class="p-6 text-center" id="login-section">
        <p class="text-amber-800 mb-6">Sign in to track your coffee consumption</p>
        <button id="google-login" class="w-full bg-white border border-gray-300 rounded-lg py-3 font-medium hover:shadow">
          ☕ Sign in with Google
        </button>
      </div>

      <div class="p-6 text-center hidden" id="confirmation-section">
        <div class="w-24 h-24 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-6">
          <i data-feather="check-circle" class="text-amber-600 w-12 h-12"></i>
        </div>
        <h2 class="text-2xl font-bold text-amber-900 mb-2">Thanks, <span id="user-name">User</span>!</h2>
        <p class="text-amber-800 mb-6">You’ve logged <span id="coffee-count">0</span> coffees ☕</p>
        <button id="add-coffee" class="w-full bg-amber-600 hover:bg-amber-700 text-white py-3 rounded-lg font-medium">Log Another Coffee</button>
      </div>
    </div>

    <div class="text-center mt-6">
      <a href="/kava2/stats" class="text-amber-700 hover:text-amber-900 font-medium inline-flex items-center">
        View Leaderboard →
      </a>
    </div>
  </div>

  <!-- Firebase + Logic -->
  <script src="https://unpkg.com/feather-icons"></script>
  <script>
    feather.replace();
  </script>

  <!-- Firebase config -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {

  apiKey: "AIzaSyBH8YkDBlrxaJxaqN6aZVIv6ILK57C5Cfg",

  authDomain: "kava-tracker.firebaseapp.com",

  projectId: "kava-tracker",

  storageBucket: "kava-tracker.firebasestorage.app",

  messagingSenderId: "38668285461",

  appId: "1:38668285461:web:58064e127935f76bd1c01c",

  measurementId: "G-242YGD0ZXT"

};

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    const loginSection = document.getElementById('login-section');
    const confirmationSection = document.getElementById('confirmation-section');
    const userName = document.getElementById('user-name');
    const coffeeCountEl = document.getElementById('coffee-count');

    let currentUser = null;
    let coffeeCount = 0;

    document.getElementById('google-login').addEventListener('click', async () => {
      const result = await signInWithPopup(auth, provider);
      currentUser = result.user;

      const userRef = doc(db, 'users', currentUser.uid);
      const userSnap = await getDoc(userRef);

      if (!userSnap.exists()) {
        await setDoc(userRef, { name: currentUser.displayName, coffeeCount: 0 });
      } else {
        coffeeCount = userSnap.data().coffeeCount;
      }

      showConfirmation();
    });

    document.getElementById('add-coffee').addEventListener('click', async () => {
      const userRef = doc(db, 'users', currentUser.uid);
      await updateDoc(userRef, { coffeeCount: increment(1) });

      const updated = await getDoc(userRef);
      coffeeCount = updated.data().coffeeCount;
      coffeeCountEl.textContent = coffeeCount;
    });

    function showConfirmation() {
      userName.textContent = currentUser.displayName.split(' ')[0];
      coffeeCountEl.textContent = coffeeCount;
      loginSection.classList.add('hidden');
      confirmationSection.classList.remove('hidden');
    }
  </script>
</body>
</html>

